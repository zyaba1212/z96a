# Учёт этапов разработки проекта z96a

Файл ведётся для сохранения последовательности действий и объёма выполненной работы. При переходе на новый этап не переписывать проект «по-своему» — продолжать от текущего состояния.

---

## Этап 3 — ЗАВЕРШЁН

**Дата завершения:** 2025-02-20

### Что сделано на этапе 3

1. **Комментарии в коде**
   - Добавлены комментарии (JSDoc/описание назначения) во все основные исходные файлы проекта:
   - **App:** `src/app/layout.tsx`, `src/app/page.tsx`, `src/app/providers.tsx`, `src/app/predlozhit/page.tsx`, `src/app/propose/page.tsx`
   - **API:** `src/app/api/tile/route.ts`, `src/app/api/geocode/reverse/route.ts`, `src/app/api/geocode/search/route.ts`, `src/app/api/auth/route.ts`, `src/app/api/auth/verify/route.ts`
   - **Компоненты:** `src/components/EarthScene.tsx`, `src/components/HomePage.tsx`, `src/components/AuthBlock.tsx`, `src/components/MapView.tsx`
   - **Lib:** `src/lib/prisma.ts`, `src/lib/ui-root.ts`
   - Файл `next-env.d.ts` не редактировался (служебный Next.js).

2. **Файл учёта этапов**
   - Создан `PROJECT_STAGES.md` (этот файл) для фиксации объёма работ и последовательности этапов.

3. **Git**
   - Все изменения закоммичены и запушены на GitHub с сообщением о завершении этапа 3.

### Текущее состояние проекта (на конец этапа 3)

- **Главная страница:** глобус (Three.js) с текстурой Земли, границами стран, подписями, звёздным небом; кнопки «Вращение», «−», «+», «На карту».
- **Переход глобус ↔ 2D:** при приближении камеры до порога — автоматический переход на 2D-карту (Leaflet); тайлы через `/api/tile` (OSM/ESRI); при отдалении (zoom < 11) — возврат на глобус; кнопка «На глобус».
- **2D-режим:** поиск по адресу (`/api/geocode/search`), обратный геокод (`/api/geocode/reverse`), отображение текущего места, стрелки панорамирования (клавиши и кнопки), зум +/−.
- **Авторизация:** блок AuthBlock (Phantom), подпись сообщения, вызов `/api/auth/verify`, после входа — ссылка «Предложить» (/propose), кнопка «Выйти».
- **Страницы «Предложить»:** `/predlozhit` и `/propose` — заглушки до этапа 5 (режим редактирования сети).
- **БД:** Prisma, модель User (pubkey); используется в API auth и auth/verify.

### Что не менять при следующих этапах без явной задачи

- Структуру маршрутов (app router) и имена файлов страниц.
- Логику перехода глобус ↔ 2D (пороги, гистерезис) и API глобуса (GlobeControls).
- Контракты API: `/api/tile`, `/api/geocode/reverse`, `/api/geocode/search`, `/api/auth`, `/api/auth/verify`.
- Подключение Solana (Phantom) и формат авторизации (message + signature).

### Следующий этап

- Продолжать с **этапа 4** по плану проекта. Не переписывать с нуля глобус, карту или авторизацию.
